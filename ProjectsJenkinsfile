#!/bin/env groovy

////////////////////////////////////////////////////////////////////////////////

def projects = [ "s-ludwig/taggedalgebraic", "repeatedly/mustache-d" ]

stage('Get compiler') {
    sh "Fetch/unpack artifacts"
}

stage('Clone') {
    def repos = [:]

    for (int i = 0; i < projects.size(); ++i) {
        def proj = projects[i]; // http://stackoverflow.com/a/35776133
        repos["$proj"] = {
            dir("$proj") {
                checkout poll: false, scm: [$class: 'GitSCM', branches: [[name: '*/master']], extensions: [[$class: 'CleanBeforeCheckout']], userRemoteConfigs: [[url: 'https://github.com/${proj}.git']]]
            }
        }
    }

    node {
        parallel repos
    }
}
